{
  "name": "GitHub Repository Analysis",
  "description": "Analyze a GitHub repository using LLM and create a summary issue",
  "steps": [
    {
      "name": "fetch-repo-metadata",
      "type": "tool",
      "config": {
        "server": "github",
        "tool": "get_repository",
        "params": {
          "owner": "{{input.owner}}",
          "repo": "{{input.repo}}"
        }
      },
      "onError": "stop"
    },
    {
      "name": "fetch-readme",
      "type": "tool",
      "config": {
        "server": "github",
        "tool": "get_file_contents",
        "params": {
          "owner": "{{input.owner}}",
          "repo": "{{input.repo}}",
          "path": "README.md"
        }
      },
      "onError": "continue"
    },
    {
      "name": "analyze-repository",
      "type": "sampling",
      "config": {
        "sampling": {
          "model": "claude-3-sonnet",
          "messages": [
            {
              "role": "system",
              "content": "You are a code analysis assistant. Analyze the provided GitHub repository information and create a concise summary."
            },
            {
              "role": "user",
              "content": "Repository: {{steps.fetch-repo-metadata.output.name}}\nDescription: {{steps.fetch-repo-metadata.output.description}}\nLanguage: {{steps.fetch-repo-metadata.output.language}}\nStars: {{steps.fetch-repo-metadata.output.stargazers_count}}\n\nREADME:\n{{steps.fetch-readme.output.content}}\n\nProvide a brief analysis covering:\n1. Main purpose of the repository\n2. Key technologies used\n3. Notable features\n4. Potential areas for contribution\n\nKeep the summary under 500 words."
            }
          ],
          "maxTokens": 1000,
          "temperature": 0.7
        }
      },
      "onError": "stop",
      "retryConfig": {
        "maxAttempts": 3,
        "backoffMs": 1000
      }
    },
    {
      "name": "check-if-popular",
      "type": "condition",
      "config": {
        "condition": {
          "type": "gt",
          "path": "steps.fetch-repo-metadata.output.stargazers_count",
          "value": 100
        },
        "then": [
          {
            "name": "create-summary-issue",
            "type": "tool",
            "config": {
              "server": "github",
              "tool": "create_issue",
              "params": {
                "owner": "{{input.owner}}",
                "repo": "{{input.repo}}",
                "title": "Repository Analysis Summary",
                "body": "## Automated Repository Analysis\n\n{{steps.analyze-repository.output.content}}\n\n---\n*Generated by MCP Connect Workflow*\n\nTokens used: {{steps.analyze-repository.output.usage.totalTokens}}\nModel: {{steps.analyze-repository.output.model}}"
              }
            }
          }
        ],
        "else": [
          {
            "name": "log-skip",
            "type": "tool",
            "config": {
              "server": "github",
              "tool": "add_issue_comment",
              "params": {
                "owner": "{{input.owner}}",
                "repo": "{{input.repo}}",
                "issue_number": 1,
                "body": "Repository analysis skipped - repository has fewer than 100 stars."
              }
            }
          }
        ]
      }
    }
  ],
  "errorHandling": {
    "strategy": "continue"
  },
  "timeout": 120000
}
