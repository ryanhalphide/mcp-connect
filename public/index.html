<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MCP Connect - Enterprise MCP Server Management</title>
  <meta name="description" content="Unified control plane for Model Context Protocol servers">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#x26A1;</text></svg>">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a24;
      --bg-card: rgba(255,255,255,0.02);
      --border-color: rgba(255,255,255,0.06);
      --border-hover: rgba(255,255,255,0.12);
      --text-primary: #f4f4f5;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-primary: #6366f1;
      --accent-secondary: #8b5cf6;
      --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #a855f7 100%);
      --success: #22c55e;
      --success-bg: rgba(34, 197, 94, 0.15);
      --warning: #f59e0b;
      --warning-bg: rgba(245, 158, 11, 0.15);
      --error: #ef4444;
      --error-bg: rgba(239, 68, 68, 0.15);
      --info: #3b82f6;
      --info-bg: rgba(59, 130, 246, 0.15);
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
      --shadow-lg: 0 8px 30px rgba(0,0,0,0.5);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --transition: all 0.2s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
      overflow-x: hidden;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--border-hover);
    }

    /* Layout */
    .app-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-icon {
      width: 44px;
      height: 44px;
      background: var(--accent-gradient);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .logo-text {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .logo-version {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: rgba(99, 102, 241, 0.15);
      color: var(--accent-primary);
    }

    .nav-item-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .nav-item-badge {
      margin-left: auto;
      background: var(--accent-gradient);
      color: white;
      font-size: 11px;
      font-weight: 600;
      padding: 2px 8px;
      border-radius: 10px;
      min-width: 24px;
      text-align: center;
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border-color);
    }

    .connection-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      font-size: 13px;
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    .status-indicator.connected {
      background: var(--success);
      box-shadow: 0 0 8px var(--success);
    }

    .status-indicator.disconnected {
      background: var(--text-muted);
    }

    .status-indicator.error {
      background: var(--error);
      box-shadow: 0 0 8px var(--error);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Main content */
    .main-content {
      flex: 1;
      margin-left: 280px;
      min-height: 100vh;
    }

    /* Top bar */
    .top-bar {
      height: 64px;
      border-bottom: 1px solid var(--border-color);
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(12px);
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .breadcrumb-divider {
      color: var(--text-muted);
    }

    .breadcrumb-current {
      color: var(--text-primary);
      font-weight: 600;
    }

    .top-bar-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .search-box {
      width: 320px;
      padding: 10px 16px 10px 40px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
      transition: var(--transition);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2371717a' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 14px center;
    }

    .search-box:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .search-box::placeholder {
      color: var(--text-muted);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--accent-gradient);
      color: white;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--border-color);
      color: var(--text-primary);
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 18px;
    }

    .btn-icon:hover {
      background: var(--border-color);
      color: var(--text-primary);
    }

    /* Page content */
    .page-content {
      padding: 32px;
    }

    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .page-subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 4px;
    }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    @media (max-width: 1400px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--accent-gradient);
      opacity: 0;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-card-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .stat-card-icon.servers { background: var(--info-bg); }
    .stat-card-icon.tools { background: var(--success-bg); }
    .stat-card-icon.requests { background: var(--warning-bg); }
    .stat-card-icon.uptime { background: rgba(139, 92, 246, 0.15); }

    .stat-card-trend {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: var(--radius-sm);
    }

    .stat-card-trend.up {
      background: var(--success-bg);
      color: var(--success);
    }

    .stat-card-trend.down {
      background: var(--error-bg);
      color: var(--error);
    }

    .stat-card-value {
      font-size: 36px;
      font-weight: 700;
      line-height: 1.1;
      margin-bottom: 4px;
    }

    .stat-card-label {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* Dashboard grid */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      margin-bottom: 32px;
    }

    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      padding: 24px;
    }

    .card-body.no-padding {
      padding: 0;
    }

    /* Chart container */
    .chart-container {
      position: relative;
      height: 280px;
      padding: 16px;
    }

    /* Activity feed */
    .activity-feed {
      max-height: 400px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      gap: 14px;
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-color);
      transition: var(--transition);
    }

    .activity-item:hover {
      background: var(--bg-tertiary);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .activity-icon.connect { background: var(--success-bg); }
    .activity-icon.disconnect { background: var(--error-bg); }
    .activity-icon.invoke { background: var(--info-bg); }
    .activity-icon.error { background: var(--warning-bg); }

    .activity-content {
      flex: 1;
      min-width: 0;
    }

    .activity-title {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .activity-description {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .activity-time {
      font-size: 11px;
      color: var(--text-muted);
      flex-shrink: 0;
    }

    /* Server cards grid */
    .servers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 20px;
    }

    .server-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 24px;
      transition: var(--transition);
    }

    .server-card:hover {
      border-color: var(--border-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .server-card-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 20px;
    }

    .server-icon {
      width: 52px;
      height: 52px;
      background: var(--accent-gradient);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
    }

    .server-info {
      flex: 1;
      min-width: 0;
    }

    .server-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .server-category {
      font-size: 13px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .server-status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .server-status-badge.connected {
      background: var(--success-bg);
      color: var(--success);
    }

    .server-status-badge.disconnected {
      background: rgba(161, 161, 170, 0.15);
      color: var(--text-muted);
    }

    .server-status-badge.error {
      background: var(--error-bg);
      color: var(--error);
    }

    .server-status-badge.connecting {
      background: var(--warning-bg);
      color: var(--warning);
    }

    .server-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }

    .server-stat {
      text-align: center;
    }

    .server-stat-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-primary);
    }

    .server-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .server-actions {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }

    .server-actions .btn {
      flex: 1;
      padding: 10px;
      font-size: 13px;
    }

    /* Tools list */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .tool-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 20px;
      cursor: pointer;
      transition: var(--transition);
    }

    .tool-card:hover {
      border-color: var(--accent-primary);
      background: rgba(99, 102, 241, 0.05);
      transform: translateY(-2px);
    }

    .tool-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent-primary);
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      margin-bottom: 8px;
    }

    .tool-description {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .tool-meta {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .tool-tag {
      background: var(--bg-tertiary);
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Circuit breaker indicators */
    .circuit-breakers {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }

    .circuit-indicator {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      border-left: 3px solid;
    }

    .circuit-indicator.closed {
      border-left-color: var(--success);
    }

    .circuit-indicator.open {
      border-left-color: var(--error);
    }

    .circuit-indicator.half_open {
      border-left-color: var(--warning);
    }

    .circuit-server {
      font-size: 13px;
      font-weight: 500;
    }

    .circuit-state {
      font-size: 11px;
      text-transform: uppercase;
      font-weight: 600;
      margin-left: auto;
      padding: 3px 8px;
      border-radius: var(--radius-sm);
    }

    .circuit-state.closed {
      background: var(--success-bg);
      color: var(--success);
    }

    .circuit-state.open {
      background: var(--error-bg);
      color: var(--error);
    }

    .circuit-state.half_open {
      background: var(--warning-bg);
      color: var(--warning);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    /* Filters */
    .filters-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .filter-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      font-size: 13px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition);
    }

    .filter-chip:hover {
      border-color: var(--accent-primary);
      color: var(--text-primary);
    }

    .filter-chip.active {
      background: rgba(99, 102, 241, 0.15);
      border-color: var(--accent-primary);
      color: var(--accent-primary);
    }

    /* Loading states */
    .skeleton {
      background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--border-color) 50%, var(--bg-tertiary) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border-color);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 640px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .page-content {
        padding: 16px;
      }

      .top-bar {
        padding: 0 16px;
      }

      .search-box {
        display: none;
      }
    }

    /* Toast notifications */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      animation: slideIn 0.3s ease;
      min-width: 300px;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success { border-left: 3px solid var(--success); }
    .toast.error { border-left: 3px solid var(--error); }
    .toast.warning { border-left: 3px solid var(--warning); }
    .toast.info { border-left: 3px solid var(--info); }

    .toast-icon {
      font-size: 18px;
    }

    .toast-message {
      flex: 1;
      font-size: 14px;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      font-size: 18px;
      padding: 0;
    }

    /* Live indicator */
    .live-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 14px;
      background: var(--success-bg);
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: var(--success);
    }

    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    /* API Key Banner */
    .api-key-banner {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 12px 32px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .api-key-banner.hidden {
      display: none;
    }

    .api-key-banner-icon {
      font-size: 20px;
    }

    .api-key-banner-text {
      flex: 1;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .api-key-input {
      width: 320px;
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 13px;
      font-family: 'JetBrains Mono', monospace;
    }

    .api-key-input:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .api-key-input::placeholder {
      color: var(--text-muted);
    }

    /* Filter chips */
    .filters-bar {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .filter-chip {
      padding: 8px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-chip:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .filter-chip.active {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
      color: white;
    }

    /* Tools grid for templates */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .tool-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .tool-card:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
    }

    .tool-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .tool-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .tool-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .tool-tag {
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">&#x26A1;</div>
          <div>
            <div class="logo-text">MCP Connect</div>
            <div class="logo-version" id="version">v0.1.0</div>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <div class="nav-item active" data-page="dashboard">
            <span class="nav-item-icon">&#x1F4CA;</span>
            <span>Dashboard</span>
          </div>
          <div class="nav-item" data-page="servers">
            <span class="nav-item-icon">&#x1F5A5;</span>
            <span>Servers</span>
            <span class="nav-item-badge" id="nav-server-count">0</span>
          </div>
          <div class="nav-item" data-page="tools">
            <span class="nav-item-icon">&#x1F6E0;</span>
            <span>Tools</span>
            <span class="nav-item-badge" id="nav-tool-count">0</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Management</div>
          <div class="nav-item" data-page="templates">
            <span class="nav-item-icon">&#x1F4CB;</span>
            <span>Templates</span>
          </div>
          <div class="nav-item" data-page="groups">
            <span class="nav-item-icon">&#x1F4C1;</span>
            <span>Groups</span>
          </div>
          <div class="nav-item" data-page="favorites">
            <span class="nav-item-icon">&#x2B50;</span>
            <span>Favorites</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Monitoring</div>
          <div class="nav-item" data-page="activity">
            <span class="nav-item-icon">&#x1F4DD;</span>
            <span>Activity Log</span>
          </div>
          <div class="nav-item" data-page="metrics">
            <span class="nav-item-icon">&#x1F4C8;</span>
            <span>Metrics</span>
          </div>
          <div class="nav-item" data-page="webhooks">
            <span class="nav-item-icon">&#x1F517;</span>
            <span>Webhooks</span>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="connection-status">
          <div class="status-indicator connected" id="sse-indicator"></div>
          <span id="sse-status">Real-time updates active</span>
        </div>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main-content">
      <!-- API Key Banner -->
      <div class="api-key-banner hidden" id="api-key-banner">
        <span class="api-key-banner-icon">&#x1F511;</span>
        <span class="api-key-banner-text">Enter your API key to access all features</span>
        <input type="password" class="api-key-input" id="api-key-input" placeholder="Enter API key...">
        <button class="btn btn-primary" onclick="saveApiKey()">Connect</button>
        <button class="btn btn-secondary" onclick="hideApiKeyBanner()">Dismiss</button>
      </div>

      <header class="top-bar">
        <div class="breadcrumb">
          <span>MCP Connect</span>
          <span class="breadcrumb-divider">/</span>
          <span class="breadcrumb-current" id="current-page">Dashboard</span>
        </div>

        <div class="top-bar-actions">
          <input type="text" class="search-box" id="global-search" placeholder="Search servers, tools, templates... (Ctrl+K)">
          <div class="live-indicator">
            <div class="live-dot"></div>
            <span>LIVE</span>
          </div>
          <button class="btn btn-icon" onclick="refreshData()" title="Refresh">&#x21BB;</button>
          <button class="btn btn-icon" onclick="showApiKeyBanner()" title="API Key Settings">&#x1F511;</button>
          <button class="btn btn-primary" onclick="showAddServerModal()">
            <span>+</span>
            <span>Add Server</span>
          </button>
        </div>
      </header>

      <div class="page-content" id="page-content">
        <!-- Dashboard page -->
        <div id="dashboard-page" class="page-container">
          <div class="page-header">
            <div>
              <h1 class="page-title">Dashboard</h1>
              <p class="page-subtitle">Monitor your MCP infrastructure at a glance</p>
            </div>
          </div>

          <!-- Stats -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon servers">&#x1F5A5;</div>
              </div>
              <div class="stat-card-value" id="stat-servers">-</div>
              <div class="stat-card-label">Connected Servers</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon tools">&#x1F6E0;</div>
              </div>
              <div class="stat-card-value" id="stat-tools">-</div>
              <div class="stat-card-label">Registered Tools</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon requests">&#x26A1;</div>
              </div>
              <div class="stat-card-value" id="stat-requests">-</div>
              <div class="stat-card-label">Requests Today</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon uptime">&#x23F1;</div>
              </div>
              <div class="stat-card-value" id="stat-uptime">-</div>
              <div class="stat-card-label">Uptime</div>
            </div>
          </div>

          <!-- Dashboard grid -->
          <div class="dashboard-grid">
            <!-- Requests chart -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">&#x1F4C8; Request Activity</h3>
                <div class="filters-bar" style="margin: 0;">
                  <button class="filter-chip active" data-range="1h">1H</button>
                  <button class="filter-chip" data-range="24h">24H</button>
                  <button class="filter-chip" data-range="7d">7D</button>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="requests-chart"></canvas>
              </div>
            </div>

            <!-- Activity feed -->
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">&#x1F4DD; Live Activity</h3>
              </div>
              <div class="card-body no-padding">
                <div class="activity-feed" id="activity-feed">
                  <div class="empty-state">
                    <div class="empty-state-icon">&#x1F4ED;</div>
                    <div class="empty-state-title">Waiting for events...</div>
                    <p>Real-time activity will appear here</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Circuit breakers -->
          <div class="card" style="margin-bottom: 32px;">
            <div class="card-header">
              <h3 class="card-title">&#x1F50C; Circuit Breakers</h3>
            </div>
            <div class="card-body">
              <div class="circuit-breakers" id="circuit-breakers">
                <div class="empty-state">
                  <p>No circuit breakers configured</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick servers view -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">&#x1F5A5; Active Servers</h3>
              <button class="btn btn-secondary" onclick="showPage('servers')">View All</button>
            </div>
            <div class="card-body">
              <div class="servers-grid" id="quick-servers">
                <div class="empty-state">
                  <div class="spinner"></div>
                  <p style="margin-top: 12px;">Loading servers...</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Servers page -->
        <div id="servers-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Servers</h1>
              <p class="page-subtitle">Manage your MCP server connections</p>
            </div>
            <button class="btn btn-primary" onclick="showAddServerModal()">+ Add Server</button>
          </div>
          <div class="servers-grid" id="servers-list">
            <div class="empty-state">
              <div class="spinner"></div>
              <p style="margin-top: 12px;">Loading servers...</p>
            </div>
          </div>
        </div>

        <!-- Tools page -->
        <div id="tools-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Tools</h1>
              <p class="page-subtitle">Browse all registered MCP tools</p>
            </div>
          </div>
          <div class="filters-bar">
            <input type="text" class="search-box" id="tools-search" placeholder="Search tools..." style="width: 300px;">
          </div>
          <div class="tools-grid" id="tools-list">
            <div class="empty-state">
              <div class="spinner"></div>
              <p style="margin-top: 12px;">Loading tools...</p>
            </div>
          </div>
        </div>

        <!-- Activity page -->
        <div id="activity-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Activity Log</h1>
              <p class="page-subtitle">Real-time event stream</p>
            </div>
          </div>
          <div class="card">
            <div class="card-body no-padding">
              <div class="activity-feed" id="activity-log" style="max-height: 600px;">
                <div class="empty-state">
                  <div class="empty-state-icon">&#x1F4ED;</div>
                  <div class="empty-state-title">No activity yet</div>
                  <p>Events will appear here in real-time</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Templates page -->
        <div id="templates-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Templates</h1>
              <p class="page-subtitle">Pre-configured MCP server templates ready to deploy</p>
            </div>
          </div>
          <div class="filters-bar">
            <button class="filter-chip active" data-category="all" onclick="filterTemplates('all')">All</button>
            <button class="filter-chip" data-category="storage" onclick="filterTemplates('storage')">Storage</button>
            <button class="filter-chip" data-category="database" onclick="filterTemplates('database')">Database</button>
            <button class="filter-chip" data-category="development" onclick="filterTemplates('development')">Development</button>
            <button class="filter-chip" data-category="communication" onclick="filterTemplates('communication')">Communication</button>
            <button class="filter-chip" data-category="ai" onclick="filterTemplates('ai')">AI</button>
          </div>
          <div class="tools-grid" id="templates-list">
            <div class="empty-state"><div class="spinner"></div><p style="margin-top: 12px;">Loading templates...</p></div>
          </div>
        </div>

        <!-- Groups page -->
        <div id="groups-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Groups</h1>
              <p class="page-subtitle">Organize servers into logical groups</p>
            </div>
            <button class="btn btn-primary" onclick="showCreateGroupModal()">+ Create Group</button>
          </div>
          <div class="servers-grid" id="groups-list">
            <div class="empty-state">
              <div class="empty-state-icon">&#x1F4C1;</div>
              <div class="empty-state-title">No groups yet</div>
              <p>Create groups to organize your servers</p>
            </div>
          </div>
        </div>

        <!-- Favorites page -->
        <div id="favorites-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Favorites</h1>
              <p class="page-subtitle">Quick access to your favorite tools</p>
            </div>
          </div>
          <div class="tools-grid" id="favorites-list">
            <div class="empty-state">
              <div class="empty-state-icon">&#x2B50;</div>
              <div class="empty-state-title">No favorites yet</div>
              <p>Star tools from the Tools page to add them here</p>
            </div>
          </div>
        </div>

        <!-- Metrics page -->
        <div id="metrics-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Metrics</h1>
              <p class="page-subtitle">System performance and usage statistics</p>
            </div>
            <button class="btn btn-secondary" onclick="loadMetricsPage()">&#x21BB; Refresh</button>
          </div>
          <div class="stats-grid" id="metrics-stats">
            <div class="stat-card">
              <div class="stat-card-header"><div class="stat-card-icon requests">&#x1F4CA;</div></div>
              <div class="stat-card-value" id="metric-total-requests">-</div>
              <div class="stat-card-label">Total Requests</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header"><div class="stat-card-icon servers">&#x2705;</div></div>
              <div class="stat-card-value" id="metric-success-rate">-</div>
              <div class="stat-card-label">Success Rate</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header"><div class="stat-card-icon tools">&#x1F5A5;</div></div>
              <div class="stat-card-value" id="metric-active-servers">-</div>
              <div class="stat-card-label">Active Servers</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header"><div class="stat-card-icon uptime">&#x1F6E0;</div></div>
              <div class="stat-card-value" id="metric-total-tools">-</div>
              <div class="stat-card-label">Total Tools</div>
            </div>
          </div>
          <div class="card" style="margin-top: 24px;">
            <div class="card-header"><h3 class="card-title">&#x1F4C8; Top Endpoints</h3></div>
            <div class="card-body no-padding">
              <div id="top-endpoints-list" style="padding: 0;"></div>
            </div>
          </div>
          <div class="card" style="margin-top: 24px;">
            <div class="card-header"><h3 class="card-title">&#x1F5A5; Server Status</h3></div>
            <div class="card-body">
              <div class="servers-grid" id="metrics-servers-list"></div>
            </div>
          </div>
        </div>

        <!-- Webhooks page -->
        <div id="webhooks-page" class="page-container" style="display: none;">
          <div class="page-header">
            <div>
              <h1 class="page-title">Webhooks</h1>
              <p class="page-subtitle">Subscribe to real-time events via webhooks</p>
            </div>
            <button class="btn btn-primary" onclick="showCreateWebhookModal()">+ Add Webhook</button>
          </div>
          <div class="card">
            <div class="card-header"><h3 class="card-title">&#x1F4E1; Available Events</h3></div>
            <div class="card-body">
              <div class="tools-grid">
                <div class="tool-card">
                  <div class="tool-name">server.connected</div>
                  <div class="tool-description">Triggered when a server connects</div>
                </div>
                <div class="tool-card">
                  <div class="tool-name">server.disconnected</div>
                  <div class="tool-description">Triggered when a server disconnects</div>
                </div>
                <div class="tool-card">
                  <div class="tool-name">server.error</div>
                  <div class="tool-description">Triggered on server errors</div>
                </div>
                <div class="tool-card">
                  <div class="tool-name">tool.invoked</div>
                  <div class="tool-description">Triggered when a tool is invoked</div>
                </div>
                <div class="tool-card">
                  <div class="tool-name">tool.error</div>
                  <div class="tool-description">Triggered on tool invocation errors</div>
                </div>
                <div class="tool-card">
                  <div class="tool-name">circuit.opened</div>
                  <div class="tool-description">Triggered when circuit breaker opens</div>
                </div>
              </div>
            </div>
          </div>
          <div class="card" style="margin-top: 24px;">
            <div class="card-header"><h3 class="card-title">&#x1F517; Subscriptions</h3></div>
            <div class="card-body">
              <div id="webhooks-list">
                <div class="empty-state">
                  <div class="empty-state-icon">&#x1F517;</div>
                  <div class="empty-state-title">No webhooks configured</div>
                  <p>Add a webhook to receive real-time event notifications</p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- Toast container -->
  <div class="toast-container" id="toast-container"></div>

  <script>
    // Global state
    const state = {
      servers: [],
      tools: [],
      activities: [],
      sseConnected: false,
      currentPage: 'dashboard',
      requestChart: null,
    };

    const API_BASE = '/api';
    let eventSource = null;

    // Get API key from localStorage (non-blocking)
    function getApiKey() {
      return localStorage.getItem('apiKey');
    }

    function getAuthHeaders() {
      const key = getApiKey();
      return key ? { 'Authorization': `Bearer ${key}` } : {};
    }

    function showApiKeyBanner() {
      const banner = document.getElementById('api-key-banner');
      const input = document.getElementById('api-key-input');
      const existingKey = getApiKey();

      // If key exists, show masked version
      if (existingKey) {
        input.placeholder = existingKey.substring(0, 12) + '...' + existingKey.slice(-4);
      } else {
        input.placeholder = 'Enter API key...';
      }
      input.value = '';
      banner.classList.remove('hidden');
    }

    function hideApiKeyBanner() {
      const banner = document.getElementById('api-key-banner');
      banner.classList.add('hidden');
    }

    function saveApiKey() {
      const input = document.getElementById('api-key-input');
      const key = input.value.trim();
      if (key) {
        localStorage.setItem('apiKey', key);
        hideApiKeyBanner();
        showToast('success', 'API key saved! Refreshing data...');
        // Reconnect SSE with new key
        connectSSE();
        // Refresh all data
        refreshData();
      } else {
        showToast('error', 'Please enter a valid API key');
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
      initializeNavigation();
      initializeSSE();
      initializeCharts();
      initializeSearch();

      // Show API key banner if no key stored
      if (!getApiKey()) {
        showApiKeyBanner();
      }

      // Handle Enter key on API key input
      document.getElementById('api-key-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') saveApiKey();
      });
    });

    async function initializeApp() {
      await Promise.all([
        fetchHealth(),
        fetchStats()
      ]);
    }

    // Navigation
    function initializeNavigation() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          const page = item.dataset.page;
          if (page) showPage(page);
        });
      });
    }

    function showPage(pageName) {
      state.currentPage = pageName;

      // Update nav active state
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.toggle('active', item.dataset.page === pageName);
      });

      // Update breadcrumb
      document.getElementById('current-page').textContent =
        pageName.charAt(0).toUpperCase() + pageName.slice(1);

      // Hide all pages
      document.querySelectorAll('.page-container').forEach(page => {
        page.style.display = 'none';
      });

      // Show the selected page
      const pageMap = {
        'dashboard': 'dashboard-page',
        'servers': 'servers-page',
        'tools': 'tools-page',
        'activity': 'activity-page',
        'templates': 'templates-page',
        'groups': 'groups-page',
        'favorites': 'favorites-page',
        'metrics': 'metrics-page',
        'webhooks': 'webhooks-page'
      };

      const pageId = pageMap[pageName] || 'dashboard-page';
      const pageEl = document.getElementById(pageId);
      if (pageEl) {
        pageEl.style.display = 'block';
      }

      // Load page-specific data
      switch (pageName) {
        case 'servers': loadServersPage(); break;
        case 'tools': loadToolsPage(); break;
        case 'templates': loadTemplatesPage(); break;
        case 'groups': loadGroupsPage(); break;
        case 'favorites': loadFavoritesPage(); break;
        case 'metrics': loadMetricsPage(); break;
        case 'webhooks': loadWebhooksPage(); break;
      }
    }

    // SSE Real-time updates
    function initializeSSE() {
      // Try to connect to SSE endpoint (requires auth in production)
      connectSSE();
    }

    function connectSSE() {
      if (eventSource) {
        eventSource.close();
      }

      const sseIndicator = document.getElementById('sse-indicator');
      const sseStatus = document.getElementById('sse-status');

      try {
        // SSE with API key authentication
        const apiKey = getApiKey();
        const sseUrl = apiKey ? `${API_BASE}/sse/events?api_key=${apiKey}` : `${API_BASE}/sse/events`;
        eventSource = new EventSource(sseUrl);

        eventSource.onopen = () => {
          state.sseConnected = true;
          sseIndicator.className = 'status-indicator connected';
          sseStatus.textContent = 'Real-time updates active';
        };

        eventSource.onerror = () => {
          state.sseConnected = false;
          sseIndicator.className = 'status-indicator disconnected';
          sseStatus.textContent = 'Reconnecting...';

          // Fallback to polling
          setTimeout(connectSSE, 5000);
        };

        eventSource.addEventListener('connected', (e) => {
          const data = JSON.parse(e.data);
          console.log('SSE connected:', data);
        });

        eventSource.addEventListener('server.connected', (e) => {
          const data = JSON.parse(e.data);
          addActivity('connect', `Server connected: ${data.serverName}`, `${data.toolCount} tools registered`);
          showToast('success', `Connected to ${data.serverName}`);
          refreshData();
        });

        eventSource.addEventListener('server.disconnected', (e) => {
          const data = JSON.parse(e.data);
          addActivity('disconnect', `Server disconnected: ${data.serverName}`, 'Connection closed');
          showToast('warning', `Disconnected from ${data.serverName}`);
          refreshData();
        });

        eventSource.addEventListener('server.error', (e) => {
          const data = JSON.parse(e.data);
          addActivity('error', `Server error: ${data.serverName}`, data.error);
          showToast('error', `Error: ${data.serverName}`);
        });

        eventSource.addEventListener('tool.invoked', (e) => {
          const data = JSON.parse(e.data);
          addActivity('invoke', `Tool invoked: ${data.toolName}`, `Duration: ${data.durationMs}ms`);
        });

        eventSource.addEventListener('circuit.opened', (e) => {
          const data = JSON.parse(e.data);
          addActivity('error', `Circuit opened: ${data.serverName}`, 'Too many failures');
          showToast('error', `Circuit breaker opened for ${data.serverName}`);
        });

        eventSource.addEventListener('keepalive', () => {
          // Heartbeat received
        });

      } catch (error) {
        console.error('SSE connection failed:', error);
        sseIndicator.className = 'status-indicator disconnected';
        sseStatus.textContent = 'Connection unavailable';
      }
    }

    // Activity feed
    function addActivity(type, title, description) {
      const feed = document.getElementById('activity-feed');
      const now = new Date();

      // Remove empty state if present
      const emptyState = feed.querySelector('.empty-state');
      if (emptyState) {
        feed.innerHTML = '';
      }

      const iconMap = {
        connect: '&#x2705;',
        disconnect: '&#x1F534;',
        invoke: '&#x26A1;',
        error: '&#x26A0;'
      };

      const activityHtml = `
        <div class="activity-item">
          <div class="activity-icon ${type}">${iconMap[type] || '&#x1F4AC;'}</div>
          <div class="activity-content">
            <div class="activity-title">${title}</div>
            <div class="activity-description">${description}</div>
          </div>
          <div class="activity-time">${now.toLocaleTimeString()}</div>
        </div>
      `;

      feed.insertAdjacentHTML('afterbegin', activityHtml);

      // Keep only last 50 activities
      while (feed.children.length > 50) {
        feed.removeChild(feed.lastChild);
      }

      state.activities.unshift({ type, title, description, time: now });
    }

    // Charts
    function initializeCharts() {
      const ctx = document.getElementById('requests-chart');
      if (!ctx) return;

      const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 280);
      gradient.addColorStop(0, 'rgba(99, 102, 241, 0.4)');
      gradient.addColorStop(1, 'rgba(99, 102, 241, 0)');

      state.requestChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: generateTimeLabels(12),
          datasets: [{
            label: 'Requests',
            data: generateSampleData(12),
            fill: true,
            backgroundColor: gradient,
            borderColor: '#6366f1',
            borderWidth: 2,
            tension: 0.4,
            pointBackgroundColor: '#6366f1',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            intersect: false,
            mode: 'index',
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              backgroundColor: '#1a1a24',
              titleColor: '#f4f4f5',
              bodyColor: '#a1a1aa',
              borderColor: 'rgba(255,255,255,0.1)',
              borderWidth: 1,
              padding: 12,
              cornerRadius: 8,
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255,255,255,0.05)',
              },
              ticks: {
                color: '#71717a',
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255,255,255,0.05)',
              },
              ticks: {
                color: '#71717a',
              }
            }
          }
        }
      });

      // Time range filters
      document.querySelectorAll('.filter-chip[data-range]').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.filter-chip[data-range]').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          updateChartRange(chip.dataset.range);
        });
      });
    }

    function generateTimeLabels(count) {
      const labels = [];
      const now = new Date();
      for (let i = count - 1; i >= 0; i--) {
        const time = new Date(now - i * 5 * 60 * 1000);
        labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
      }
      return labels;
    }

    function generateSampleData(count) {
      return Array.from({ length: count }, () => Math.floor(Math.random() * 100) + 20);
    }

    function updateChartRange(range) {
      if (!state.requestChart) return;

      let count;
      switch (range) {
        case '1h': count = 12; break;
        case '24h': count = 24; break;
        case '7d': count = 7; break;
        default: count = 12;
      }

      state.requestChart.data.labels = generateTimeLabels(count);
      state.requestChart.data.datasets[0].data = generateSampleData(count);
      state.requestChart.update();
    }

    // Search
    function initializeSearch() {
      const searchBox = document.getElementById('global-search');

      document.addEventListener('keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          searchBox.focus();
        }
        if (e.key === 'Escape') {
          searchBox.blur();
        }
      });

      searchBox.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        // Implement search logic here
      });
    }

    // API calls
    async function fetchHealth() {
      try {
        const res = await fetch(`${API_BASE}/health`);
        const json = await res.json();

        if (json.success) {
          const data = json.data;
          document.getElementById('stat-servers').textContent = data.servers?.connected || 0;
          document.getElementById('stat-tools').textContent = data.tools?.registered || 0;
          document.getElementById('stat-uptime').textContent = formatUptime(data.uptime);
          document.getElementById('version').textContent = `v${data.version}`;

          // Update nav badges
          document.getElementById('nav-server-count').textContent = data.servers?.total || 0;
          document.getElementById('nav-tool-count').textContent = data.tools?.registered || 0;
        }
      } catch (err) {
        console.error('Failed to fetch health:', err);
      }
    }

    async function fetchStats() {
      try {
        const res = await fetch(`${API_BASE}/monitor/stats`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data) {
            document.getElementById('stat-requests').textContent = json.data.totalRequests || '0';
          }
        }
      } catch (err) {
        // Stats endpoint may require auth, use fallback
        document.getElementById('stat-requests').textContent = '0';
      }

      // Fetch and render servers
      await fetchServers();
    }

    async function fetchServers() {
      try {
        const res = await fetch(`${API_BASE}/servers`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data) {
            state.servers = json.data;
            renderServers(json.data.map(s => ({
              name: s.name,
              category: s.metadata?.category || 'General',
              status: s.connectionStatus,
              toolCount: s.toolCount || 0,
              resourceCount: s.resourceCount || 0,
              requests: 0
            })));
          }
        }
      } catch (err) {
        console.error('Failed to fetch servers:', err);
        renderServers([]);
      }
    }

    function renderServers(servers) {
      const container = document.getElementById('quick-servers');

      if (!servers || servers.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F5A5;</div>
            <div class="empty-state-title">No servers connected</div>
            <p>Add a server to get started</p>
          </div>
        `;
        return;
      }

      container.innerHTML = servers.map(server => `
        <div class="server-card">
          <div class="server-card-header">
            <div class="server-icon">${getServerIcon(server.name)}</div>
            <div class="server-info">
              <div class="server-name">${server.name}</div>
              <div class="server-category">${server.category || 'General'}</div>
            </div>
            <div class="server-status-badge ${server.status || 'disconnected'}">
              ${server.status || 'Disconnected'}
            </div>
          </div>
          <div class="server-stats">
            <div class="server-stat">
              <div class="server-stat-value">${server.toolCount || 0}</div>
              <div class="server-stat-label">Tools</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-value">${server.resourceCount || 0}</div>
              <div class="server-stat-label">Resources</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-value">${server.requests || 0}</div>
              <div class="server-stat-label">Requests</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function getServerIcon(name) {
      const icons = {
        filesystem: '&#x1F4C1;',
        memory: '&#x1F9E0;',
        github: '&#x1F419;',
        postgres: '&#x1F418;',
        slack: '&#x1F4AC;',
        default: '&#x1F5A5;'
      };
      const key = Object.keys(icons).find(k => name.toLowerCase().includes(k));
      return icons[key] || icons.default;
    }

    // Utility functions
    function formatUptime(seconds) {
      if (!seconds) return '-';
      const days = Math.floor(seconds / 86400);
      const hours = Math.floor((seconds % 86400) / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);

      if (days > 0) return `${days}d ${hours}h`;
      if (hours > 0) return `${hours}h ${minutes}m`;
      return `${minutes}m`;
    }

    function refreshData() {
      fetchHealth();
      fetchStats();
    }

    // Toast notifications
    function showToast(type, message) {
      const container = document.getElementById('toast-container');

      const icons = {
        success: '&#x2705;',
        error: '&#x274C;',
        warning: '&#x26A0;',
        info: '&#x2139;'
      };

      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <span class="toast-icon">${icons[type]}</span>
        <span class="toast-message">${message}</span>
        <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
      `;

      container.appendChild(toast);

      // Auto remove after 5 seconds
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove();
        }
      }, 5000);
    }

    // Modal functions (placeholder)
    function showAddServerModal() {
      showToast('info', 'Server creation requires API authentication');
    }

    // Page loaders
    async function loadServersPage() {
      const container = document.getElementById('servers-list');
      try {
        const res = await fetch(`${API_BASE}/servers`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data) {
            renderServersPage(json.data);
          }
        }
      } catch (err) {
        console.error('Failed to load servers:', err);
        container.innerHTML = '<div class="empty-state"><p>Failed to load servers</p></div>';
      }
    }

    function renderServersPage(servers) {
      const container = document.getElementById('servers-list');
      if (!servers || servers.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F5A5;</div>
            <div class="empty-state-title">No servers configured</div>
            <p>Add a server to get started</p>
          </div>
        `;
        return;
      }

      container.innerHTML = servers.map(server => `
        <div class="server-card">
          <div class="server-card-header">
            <div class="server-icon">${getServerIcon(server.name)}</div>
            <div class="server-info">
              <div class="server-name">${server.name}</div>
              <div class="server-category">${server.metadata?.category || 'General'}</div>
            </div>
            <div class="server-status-badge ${server.connectionStatus || 'disconnected'}">
              ${server.connectionStatus || 'Disconnected'}
            </div>
          </div>
          <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 16px;">
            ${server.description || 'No description'}
          </p>
          <div class="server-stats">
            <div class="server-stat">
              <div class="server-stat-value">${server.toolCount || 0}</div>
              <div class="server-stat-label">Tools</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-value">${server.transport?.type || '-'}</div>
              <div class="server-stat-label">Transport</div>
            </div>
            <div class="server-stat">
              <div class="server-stat-value">${server.enabled ? 'Yes' : 'No'}</div>
              <div class="server-stat-label">Enabled</div>
            </div>
          </div>
          <div class="server-actions">
            ${server.connectionStatus === 'connected'
              ? `<button class="btn btn-secondary" onclick="disconnectServer('${server.id}')">Disconnect</button>`
              : `<button class="btn btn-primary" onclick="connectServer('${server.id}')">Connect</button>`
            }
          </div>
        </div>
      `).join('');
    }

    async function connectServer(serverId) {
      try {
        const res = await fetch(`${API_BASE}/servers/${serverId}/connect`, {
          method: 'POST',
          headers: getAuthHeaders()
        });
        if (res.ok) {
          showToast('success', 'Server connected');
          loadServersPage();
          fetchHealth();
        } else {
          showToast('error', 'Failed to connect server');
        }
      } catch (err) {
        showToast('error', 'Connection error');
      }
    }

    async function disconnectServer(serverId) {
      try {
        const res = await fetch(`${API_BASE}/servers/${serverId}/disconnect`, {
          method: 'POST',
          headers: getAuthHeaders()
        });
        if (res.ok) {
          showToast('success', 'Server disconnected');
          loadServersPage();
          fetchHealth();
        } else {
          showToast('error', 'Failed to disconnect server');
        }
      } catch (err) {
        showToast('error', 'Disconnection error');
      }
    }

    async function loadToolsPage() {
      const container = document.getElementById('tools-list');
      try {
        const res = await fetch(`${API_BASE}/tools`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data) {
            // API returns {tools: [...]} not a direct array
            const tools = json.data.tools || json.data;
            state.tools = tools;
            renderToolsPage(tools);
            initToolsSearch();
          }
        } else {
          container.innerHTML = '<div class="empty-state"><p>Authentication required to view tools</p></div>';
        }
      } catch (err) {
        console.error('Failed to load tools:', err);
        container.innerHTML = '<div class="empty-state"><p>Failed to load tools</p></div>';
      }
    }

    function renderToolsPage(tools) {
      const container = document.getElementById('tools-list');
      if (!tools || tools.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F6E0;</div>
            <div class="empty-state-title">No tools registered</div>
            <p>Connect a server to see available tools</p>
          </div>
        `;
        return;
      }

      container.innerHTML = tools.map(tool => `
        <div class="tool-card" data-tool-name="${tool.name.toLowerCase()}">
          <div class="tool-name">${tool.name}</div>
          <div class="tool-description">${tool.description || 'No description'}</div>
          <div class="tool-meta">
            <span class="tool-tag">${tool.serverName || 'Unknown'}</span>
            ${tool.inputSchema?.required?.length ? `<span class="tool-tag">${tool.inputSchema.required.length} params</span>` : ''}
          </div>
        </div>
      `).join('');
    }

    function initToolsSearch() {
      const searchInput = document.getElementById('tools-search');
      if (searchInput) {
        searchInput.oninput = (e) => {
          const query = e.target.value.toLowerCase();
          document.querySelectorAll('.tool-card').forEach(card => {
            const name = card.dataset.toolName || '';
            card.style.display = name.includes(query) ? 'block' : 'none';
          });
        };
      }
    }

    // Templates page
    let allTemplates = [];
    async function loadTemplatesPage() {
      const container = document.getElementById('templates-list');
      try {
        const res = await fetch(`${API_BASE}/templates`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data) {
            allTemplates = json.data.templates || [];
            renderTemplates(allTemplates);
          }
        }
      } catch (err) {
        console.error('Failed to load templates:', err);
        container.innerHTML = '<div class="empty-state"><p>Failed to load templates</p></div>';
      }
    }

    function renderTemplates(templates) {
      const container = document.getElementById('templates-list');
      if (!templates || templates.length === 0) {
        container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">&#x1F4CB;</div><div class="empty-state-title">No templates available</div></div>';
        return;
      }

      const iconMap = {
        'folder': '&#x1F4C1;', 'database': '&#x1F4BE;', 'github': '&#x1F419;',
        'message-square': '&#x1F4AC;', 'cloud': '&#x2601;', 'search': '&#x1F50D;',
        'globe': '&#x1F310;', 'monitor': '&#x1F5A5;', 'image': '&#x1F5BC;',
        'brain': '&#x1F9E0;', 'check-square': '&#x2705;', 'file-text': '&#x1F4C4;',
        'message-circle': '&#x1F4AC;', 'alert-circle': '&#x26A0;', 'git-branch': '&#x1F500;',
        'clock': '&#x1F552;', 'box': '&#x1F4E6;', 'server': '&#x1F5A5;', 'table': '&#x1F4CA;',
        'phone': '&#x1F4DE;', 'mail': '&#x1F4E7;', 'credit-card': '&#x1F4B3;', 'alert-triangle': '&#x26A0;'
      };

      container.innerHTML = templates.map(t => `
        <div class="tool-card" data-category="${t.category}" onclick="deployTemplate('${t.id}')">
          <div class="tool-name">${iconMap[t.icon] || '&#x1F4E6;'} ${t.name}</div>
          <div class="tool-description">${t.description || 'No description'}</div>
          <div class="tool-meta">
            <span class="tool-tag">${t.category}</span>
            ${t.isBuiltIn ? '<span class="tool-tag">Built-in</span>' : ''}
          </div>
        </div>
      `).join('');
    }

    function filterTemplates(category) {
      document.querySelectorAll('.filter-chip[data-category]').forEach(c =>
        c.classList.toggle('active', c.dataset.category === category));

      if (category === 'all') {
        renderTemplates(allTemplates);
      } else {
        renderTemplates(allTemplates.filter(t => t.category === category));
      }
    }

    function deployTemplate(templateId) {
      showToast('info', 'Template deployment coming soon! Use API to deploy.');
    }

    // Groups page
    async function loadGroupsPage() {
      const container = document.getElementById('groups-list');
      try {
        const res = await fetch(`${API_BASE}/groups`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data && json.data.length > 0) {
            renderGroups(json.data);
          } else {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">&#x1F4C1;</div><div class="empty-state-title">No groups yet</div><p>Create groups to organize your servers</p></div>';
          }
        }
      } catch (err) {
        console.error('Failed to load groups:', err);
      }
    }

    function renderGroups(groups) {
      const container = document.getElementById('groups-list');
      container.innerHTML = groups.map(g => `
        <div class="server-card">
          <div class="server-card-header">
            <div class="server-icon">&#x1F4C1;</div>
            <div class="server-info">
              <div class="server-name">${g.name}</div>
              <div class="server-category">${g.description || 'No description'}</div>
            </div>
          </div>
          <div class="server-stats">
            <div class="server-stat">
              <div class="server-stat-value">${g.serverCount || 0}</div>
              <div class="server-stat-label">Servers</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function showCreateGroupModal() {
      showToast('info', 'Group creation available via API');
    }

    // Favorites page
    async function loadFavoritesPage() {
      const container = document.getElementById('favorites-list');
      try {
        const res = await fetch(`${API_BASE}/favorites`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data?.favorites?.length > 0) {
            renderFavorites(json.data.favorites);
          } else {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">&#x2B50;</div><div class="empty-state-title">No favorites yet</div><p>Star tools from the Tools page to add them here</p></div>';
          }
        }
      } catch (err) {
        console.error('Failed to load favorites:', err);
      }
    }

    function renderFavorites(favorites) {
      const container = document.getElementById('favorites-list');
      container.innerHTML = favorites.map(f => `
        <div class="tool-card">
          <div class="tool-name">&#x2B50; ${f.toolName}</div>
          <div class="tool-description">${f.description || 'No description'}</div>
          <div class="tool-meta">
            <span class="tool-tag">${f.serverName || 'Unknown'}</span>
          </div>
        </div>
      `).join('');
    }

    // Metrics page
    async function loadMetricsPage() {
      try {
        const res = await fetch(`${API_BASE}/monitor/stats`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data) {
            renderMetrics(json.data);
          }
        }
      } catch (err) {
        console.error('Failed to load metrics:', err);
      }
    }

    function renderMetrics(data) {
      // Calculate totals
      const totalRequests = Object.values(data.endpoints?.byPath || {}).reduce((a, b) => a + b, 0);
      const successCount = data.endpoints?.byStatus?.['200'] || 0;
      const successRate = totalRequests > 0 ? Math.round((successCount / totalRequests) * 100) : 0;
      const activeServers = data.servers?.filter(s => s.status === 'connected').length || 0;
      const totalTools = data.servers?.reduce((a, s) => a + (s.toolCount || 0), 0) || 0;

      document.getElementById('metric-total-requests').textContent = totalRequests;
      document.getElementById('metric-success-rate').textContent = successRate + '%';
      document.getElementById('metric-active-servers').textContent = activeServers;
      document.getElementById('metric-total-tools').textContent = totalTools;

      // Top endpoints
      const endpointsList = document.getElementById('top-endpoints-list');
      if (data.topEndpoints?.length > 0) {
        endpointsList.innerHTML = data.topEndpoints.map(e => `
          <div class="activity-item">
            <div class="activity-content">
              <div class="activity-title" style="font-family: monospace;">${e.path}</div>
            </div>
            <div class="activity-time">${e.count} requests</div>
          </div>
        `).join('');
      } else {
        endpointsList.innerHTML = '<div class="empty-state"><p>No endpoint data yet</p></div>';
      }

      // Server status
      const serversContainer = document.getElementById('metrics-servers-list');
      if (data.servers?.length > 0) {
        serversContainer.innerHTML = data.servers.map(s => `
          <div class="server-card">
            <div class="server-card-header">
              <div class="server-icon">${getServerIcon(s.name)}</div>
              <div class="server-info">
                <div class="server-name">${s.name}</div>
                <div class="server-category">${s.category || 'General'}</div>
              </div>
              <div class="server-status-badge ${s.status}">${s.status}</div>
            </div>
            <div class="server-stats">
              <div class="server-stat">
                <div class="server-stat-value">${s.toolCount || 0}</div>
                <div class="server-stat-label">Tools</div>
              </div>
              <div class="server-stat">
                <div class="server-stat-value">${s.rateLimit?.requestsPerMinute || '-'}</div>
                <div class="server-stat-label">Rate/min</div>
              </div>
            </div>
          </div>
        `).join('');
      }
    }

    // Webhooks page
    async function loadWebhooksPage() {
      try {
        const res = await fetch(`${API_BASE}/webhooks/subscriptions`, { headers: getAuthHeaders() });
        if (res.ok) {
          const json = await res.json();
          if (json.success && json.data?.subscriptions?.length > 0) {
            renderWebhooks(json.data.subscriptions);
          }
        }
      } catch (err) {
        console.error('Failed to load webhooks:', err);
      }
    }

    function renderWebhooks(webhooks) {
      const container = document.getElementById('webhooks-list');
      container.innerHTML = webhooks.map(w => `
        <div class="activity-item">
          <div class="activity-icon connect">&#x1F517;</div>
          <div class="activity-content">
            <div class="activity-title">${w.url}</div>
            <div class="activity-description">Events: ${w.events?.join(', ') || 'All'}</div>
          </div>
          <div class="activity-time">${w.active ? 'Active' : 'Inactive'}</div>
        </div>
      `).join('');
    }

    function showCreateWebhookModal() {
      showToast('info', 'Webhook creation available via API');
    }

    // Auto-refresh
    setInterval(fetchHealth, 30000);
  </script>
</body>
</html>
